---
title: "Semin√°rio Modelos"
author: "Catarina, Isabella, J√∫lia, Lucas e Tiago"
output: 
  html_document:
    toc: TRUE
    toc_float: TRUE
---
```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(ggplot2)
library(pastecs)
library(gridExtra)
library(knitr)
library(tidyr)
library(dplyr)
library(qqplotr)
library(lmtest)
library(ggfortify)
library(GGally)
library(car)
library(corrplot)
library(kableExtra)

```

## Banco de dados

O link para o banco de dados escolhido pode ser acessado <a href="https://www.kaggle.com/datasets/unsdsn/world-happiness?select=2019.csv" target="_blank">aqui</a>.

## Objetivo
O trabalho tem como objetivo prever a pontua√ß√£o de felicidade (Score) de diferentes pa√≠ses com base em vari√°veis socioecon√¥micas e ambientais, como PIB per capita, suporte social, expectativa de vida, liberdade para tomar decis√µes, generosidade e percep√ß√£o de corrup√ß√£o e assim, verificar quais caracter√≠sticas contribuem para um pa√≠s mais feliz. 

## Especifica√ß√£o da base de dados:
O banco de dados "The World Happiness Report" apresenta o ranking dos pa√≠ses mais felizes em 2019 de acordo com v√°rios crit√©rios, os quais s√£o o PIB per capta, apoio social, expectativa de vida, liberdade para fazer escolhas, generosidade e percep√ß√£o de corrup√ß√£o. Como objetivo, esse banco quer mostrar tanto o que falta para os pa√≠ses serem mais felizes, quanto ajudar os governos a identificar onde necessita-se mais investimento. 


```{r, message=FALSE, warning=FALSE, echo =FALSE}

# Criar a especifica√ß√£o da base de dados como um data.frame
especificacao <- data.frame(
  Coluna = c(
    "Overall rank", "Country or region", "Score", "GDP per capita", 
    "Social support", "Healthy life expectancy", "Freedom to make life choices", 
    "Generosity", "Perceptions of corruption"
  ),
  Descri√ß√£o = c(
    "Ranking geral do pa√≠s.",
    "Nome do pa√≠s ou regi√£o.",
    "Pontua√ß√£o geral de felicidade (vari√°vel dependente).",
    "PIB per capita.",
    "Suporte social.",
    "Expectativa de vida.",
    "Liberdade para tomar decis√µes na vida.",
    "Generosidade.",
    "Percep√ß√£o de corrup√ß√£o."
  )
)

# Criar a tabela formatada
especificacao %>%
  kable(
    format = "html",
    caption = "Especifica√ß√£o da Base de Dados",
    col.names = c("Coluna", "Descri√ß√£o")
  ) %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))
```


## Determina√ß√£o das vari√°veis explicativas e resposta:

### Vari√°vel Resposta (Dependente)
- **Score**: Pontua√ß√£o geral de felicidade, que ser√° prevista pelo modelo.

### Vari√°veis Explicativas (Independentes)
- **GDP.per.capita**: Representa a prosperidade econ√¥mica de um pa√≠s.
- **Social.support**: Mede o suporte social dispon√≠vel.
- **Healthy.life.expectancy**: Reflete a sa√∫de da popula√ß√£o.
- **Freedom.to.make.life.choices**: Captura a liberdade percebida nas decis√µes pessoais.
- **Generosity**: Indica a disposi√ß√£o para ajudar os outros.
- **Perceptions.of.corruption**: Mede a percep√ß√£o de corrup√ß√£o no governo e nos neg√≥cios


## An√°lise Descritiva

### Score

```{r, message=FALSE, warning=FALSE, echo =FALSE}
dados <- read.csv("2019.csv", header = TRUE, sep = ",", stringsAsFactors = FALSE)
colnames(dados) <- make.names(colnames(dados))
summary(dados$Score)

# Histograma
ggplot(dados, aes(x = Score)) +
  geom_histogram(bins = 15, fill = "#3eb2e4", color = "black", alpha = 0.7) +
  labs(title = "Histograma Score", x = "Score", y = "Frequ√™ncia") 
```


### PIB per capita
```{r, message=FALSE, warning=FALSE, echo =FALSE}
summary(dados$GDP.per.capita)

# Gr√°fico Dispers√£o
library(ggplot2)

dados %>%
  ggplot() +
  geom_point(aes(x = Score, y = GDP.per.capita)) +
  labs(
    x = "Score de felicidade",
    y = "PIB per Capita",
    title = "Rela√ß√£o entre PIB per Capita e Felicidade"
  ) +
  theme_minimal()

# Histograma:
ggplot(dados, aes(x = GDP.per.capita)) +
  geom_histogram(bins = 15, fill = "#3eb2e4", color = "black", alpha = 0.7) +
  labs(title = "Histograma PIB per Capita", x = "PIB per Capita", y = "Frequ√™ncia") 

# Filtrando o pa√≠s com maior PIB per capita
pais_maior_pib <- dados %>%
  filter(GDP.per.capita == max(GDP.per.capita, na.rm = TRUE))
titulo <- paste("O pa√≠s com o maior PIB per capita √©:", pais_maior_pib$Country, 
                "- PIB per capita:", pais_maior_pib$GDP.per.capita)
cat(titulo)

# Filtrando o pa√≠s com menor PIB per capita 
pais_zero_pib <- dados %>%
  filter(GDP.per.capita == 0)
titulo <- paste("O pa√≠s com o menor PIB per capita √©:", pais_zero_pib$Country, 
                "- PIB per capita:", pais_zero_pib$GDP.per.capita)
cat(titulo)
```

### Suporte social

```{r, message=FALSE, warning=FALSE, echo =FALSE}
summary(dados$Social.support)

# Gr√°fico Dispers√£o
dados %>%
  ggplot() +
  geom_point(aes(x = Score, y = Social.support)) +
  labs(
    x = "Score de felicidade",
    y = "Suporte social",
    title = "Rela√ß√£o entre Suporte social e Felicidade"
  ) +
  theme_minimal()

# Histograma:
ggplot(dados, aes(x = Social.support)) +
  geom_histogram(bins = 15, fill = "#3eb2e4", color = "black", alpha = 0.7) +
  labs(title = "Histograma Suporte social", x = "Suporte social", y = "Frequ√™ncia") 

# Filtrando o pa√≠s com maior suporte social
pais_maior_social <- dados %>%
  filter(Social.support == max(Social.support, na.rm = TRUE))
titulo <- paste("O pa√≠s com o maior suporte social √©:", pais_maior_social$Country, 
                "- Suporte social", pais_maior_social$Social.support)
cat(titulo)

# Filtrando o pa√≠s com menor suporte social 
pais_zero_social <- dados %>%
  filter(Social.support == 0)
titulo <- paste("O pa√≠s com o menor suporte social √©:", pais_zero_social$Country, 
                "- Suporte social:", pais_zero_social$Social.support)
cat(titulo)
```

### Expectativa de vida

```{r, message=FALSE, warning=FALSE, echo =FALSE}
summary(dados$Healthy.life.expectancy)

# Gr√°fico Dispers√£o
dados %>%
  ggplot() +
  geom_point(aes(x = Score, y = Healthy.life.expectancy)) +
  labs(
    x = "Score de felicidade",
    y = "Expectativa de vida",
    title = "Rela√ß√£o entre Expectativa de vida e Felicidade"
  ) +
  theme_minimal()

# Histograma:
ggplot(dados, aes(x = Healthy.life.expectancy)) +
  geom_histogram(bins = 15, fill = "#3eb2e4", color = "black", alpha = 0.7) +
  labs(title = "Histograma Expectativa de vida", x = "Expectativa de vida", y = "Frequ√™ncia") 


# Filtrando o pa√≠s com maior expectativa de vida
pais_maior_expectativa <- dados %>%
  filter(Healthy.life.expectancy == max(Healthy.life.expectancy, na.rm = TRUE))
titulo <- paste("O pa√≠s com o maior expectativa de vida √©:", pais_maior_expectativa$Country, 
                "- Expectativa de vida:", pais_maior_expectativa$Healthy.life.expectancy)
cat(titulo)

# Filtrando o pa√≠s com menor expectativa de vida 
pais_zero_expectativa <- dados %>%
  filter(Healthy.life.expectancy == 0)
titulo <- paste("O pa√≠s com o menor expectativa de vida √©:", pais_zero_expectativa$Country, 
                "- Expectativa de vida:", pais_zero_expectativa$Healthy.life.expectancy)
cat(titulo)
```

### Liberdade para fazer escolhas

```{r, message=FALSE, warning=FALSE, echo =FALSE}
summary(dados$Freedom.to.make.life.choices)

# Gr√°fico Dispers√£o
dados %>%
  ggplot() +
  geom_point(aes(x = Score, y = Freedom.to.make.life.choices)) +
  labs(
    x = "Score de felicidade",
    y = "Liberdade para fazer escolhas",
    title = "Rela√ß√£o entre Liberdade para fazer escolhas e Felicidade"
  ) +
  theme_minimal()

# Histograma
ggplot(dados, aes(x = Freedom.to.make.life.choices)) +
  geom_histogram(bins = 15, fill = "#3eb2e4", color = "black", alpha = 0.7) +
  labs(title = "Histograma Liberdade para fazer escolhas", x = "Liberdade para fazer escolhas", y = "Frequ√™ncia") 

# Filtrando o pa√≠s com maior liberdade para fazer escolhas
pais_maior_liberdade <- dados %>%
  filter(Freedom.to.make.life.choices == max(Freedom.to.make.life.choices, na.rm = TRUE))
titulo <- paste("O pa√≠s com o maior liberdade para fazer escolhas √©:", pais_maior_liberdade$Country, 
                "- Liberdade para fazer escolhas:", pais_maior_liberdade$Freedom.to.make.life.choices)
cat(titulo)

# Filtrando o pa√≠s com menor liberdade para fazer escolhas
pais_zero_liberdade <- dados %>%
  filter(Freedom.to.make.life.choices == 0)
titulo <- paste("O pa√≠s com o menor liberdade para fazer escolhas √©:", pais_zero_liberdade$Country, 
                "- Liberdade para fazer escolhas:", pais_zero_liberdade$Freedom.to.make.life.choices)
cat(titulo)

```

### Generosidade

```{r, message=FALSE, warning=FALSE, echo =FALSE}
summary(dados$Generosity)

# Gr√°fico Dispers√£o
dados %>%
  ggplot() +
  geom_point(aes(x = Score, y = Generosity)) +
  labs(
    x = "Score de felicidade",
    y = "Generosidade",
    title = "Rela√ß√£o entre Generosidade e Felicidade"
  ) +
  theme_minimal()

# Histograma
ggplot(dados, aes(x = Generosity)) +
  geom_histogram(bins = 15, fill = "#3eb2e4", color = "black", alpha = 0.7) +
  labs(title = "Histograma Generosidade", x = "Generosidade", y = "Frequ√™ncia") 

# Filtrando o pa√≠s com maior generosidade
pais_maior_generosidade <- dados %>%
  filter(Generosity == max(Generosity, na.rm = TRUE))
titulo <- paste("O pa√≠s com o maior generosidade √©:", pais_maior_generosidade$Country, 
                "- Generosidade:", pais_maior_generosidade$Generosity)
cat(titulo)

# Filtrando o pa√≠s com menor generosidade
pais_zero_generosidade <- dados %>%
  filter(Generosity == 0)
titulo <- paste("O pa√≠s com o menor generosidade √©:", pais_zero_generosidade$Country, 
                "- Generosidade:", pais_zero_generosidade$Generosity)
cat(titulo)

```

### Percep√ß√£o de corrup√ß√£o

```{r, message=FALSE, warning=FALSE, echo =FALSE}
summary(dados$Perceptions.of.corruption)

# Gr√°fico
dados %>%
  ggplot() +
  geom_point(aes(x = Score, y = Perceptions.of.corruption)) +
  labs(
    x = "Score de felicidade",
    y = "Percep√ß√£o de corrup√ß√£o",
    title = "Rela√ß√£o entre Percep√ß√£o de corrup√ß√£o e Felicidade"
  ) +
  theme_minimal()

# Histograma
ggplot(dados, aes(x =  Perceptions.of.corruption)) +
  geom_histogram(bins = 15, fill = "#3eb2e4", color = "black", alpha = 0.7) +
  labs(title = "Histograma Percep√ß√£o de corrup√ß√£o", x = "Percep√ß√£o de corrup√ß√£o", y = "Frequ√™ncia") 

# Filtrando o pa√≠s com maior percep√ß√£o de corrup√ß√£o
pais_maior_corrupcao <- dados %>%
  filter(Perceptions.of.corruption == max(Perceptions.of.corruption, na.rm = TRUE))
titulo <- paste("O pa√≠s com o maior percep√ß√£o de corrup√ß√£o √©:", pais_maior_corrupcao$Country, 
                "- Percep√ß√£o de corrup√ß√£o:", pais_maior_corrupcao$Perceptions.of.corruption)
cat(titulo)

# Filtrando o pa√≠s com menor percep√ß√£o de corrup√ß√£o
pais_zero_corrupcao <- dados %>%
  filter(Perceptions.of.corruption == 0)
titulo <- paste("O pa√≠s com o menor percep√ß√£o de corrup√ß√£o √©:", pais_zero_corrupcao$Country, 
                "- Percep√ß√£o de corrup√ß√£o:", pais_zero_corrupcao$Perceptions.of.corruption)
cat(titulo)

```


## Modelo

```{r, message=FALSE, warning=FALSE}
# Troca do nome do banco de dados para separar a parte descritiva do modelo

data <- read.csv("2019.csv", header = TRUE, sep = ",", stringsAsFactors = FALSE)
colnames(data) <- make.names(colnames(data))
modelo <- lm(Score ~ GDP.per.capita + Social.support + Healthy.life.expectancy +
               Freedom.to.make.life.choices + Generosity + Perceptions.of.corruption, 
             data = data)

summary(modelo)

```


## Reta de regress√£o

$$
Score = 1.7052 + 0.7754*GPD.per.capita + 1.1242 * Social.support + 1.0781 * Healthy.life.expectancy + 1.4584 * Freedom.to.make.life.choices + 0.4898 * Generosity + 0.9723 * Perceptions.of.corruption + Œµ
$$


## Retas de regress√£o individuais 

**- Rela√ß√£o individual das vari√°veis explicativas(GDP per capIta, Social support, Healthy life expectancy, Freedom to make life choices, Generosity e Perceptions of corruption) com a vari√°vel resposta(Score)**

```{r, message=FALSE, warning=FALSE}
variaveis <- c("GDP.per.capita", "Social.support", "Healthy.life.expectancy", 
               "Freedom.to.make.life.choices", "Generosity", "Perceptions.of.corruption")

for (var in variaveis) {
  p <- ggplot(data, aes_string(x = var, y = "Score")) +
    geom_point(color = "blue", alpha = 0.6, size = 3) +
    geom_smooth(method = "lm", se = FALSE, color = "red", linewidth = 1) +
    labs(
      title = paste("Rela√ß√£o entre", var, "e Score"),
      x = var,
      y = "Pontua√ß√£o de Felicidade (Score)"
    ) +
    theme_minimal()
  
  print(p)
}

```


## Interpreta√ß√£o dos coeficientes 


### Intercepto (\( \text{Intercept} = 1.7952 \)):

- O valor m√©dio de \( \text{Score} \) √© **1.7952** quando todas as vari√°veis independentes (\( \text{GDP.per.capita}, \text{Social.support}, \dots \)) s√£o iguais a zero.

- Embora o intercepto seja estatisticamente significativo (\( p < 0.05 \)), n√£o tem uma interpreta√ß√£o pr√°tica relevante, pois valores zero n√£o fazem sentido neste contexto.


### GDP per capita(\( \beta = 0.7754, p < 0.05 \)):

- Cada aumento de 1 unidade no \( \text{GDP.per.capita} \) est√° associado a um aumento m√©dio de **0.7754 unidades** em \( \text{Score} \), mantendo as outras vari√°veis constantes.

- √â significativo para o modelo (\( p < 0.05 \)), mostrando que a prosperidade econ√¥mica √© um forte preditor de felicidade.

### Social support(\( \beta = 1.1242, p < 0.05 \)):
- Cada aumento de 1 unidade no \( \text{Social.support} \) est√° associado a um aumento m√©dio de **1.1242 unidades** em \( \text{Score} \), mantendo as outras vari√°veis constantes.

- √â significativo para o modelo (\( p < 0.05 \)), indicando que o suporte social √© uma vari√°vel importante para felicidade.

### Healthy life expectancy(\( \beta = 1.0782, p < 0.05 \)):

- Cada aumento de 1 unidade na expectativa de vida est√° associado a um aumento m√©dio de **1.0781 unidades** em \( \text{Score} \), mantendo as outras vari√°veis constantes.

- √â significativo para o modelo (\( p < 0.05 \)), mostrando que a sa√∫de impacta fortemente a felicidade.

### Freedom to make life choices(\( \beta = 1.4548, p < 0.05 \)):
- Cada aumento de 1 unidade na liberdade para tomar decis√µes est√° associado a um aumento m√©dio de **1.4548 unidades** em \( \text{Score} \), mantendo as outras vari√°veis constantes.

- √â significativo para o modelo (\( p < 0.05 \)), indicando que a percep√ß√£o de liberdade √© importante na felicidade.

### Generosity(\( \beta = 0.4898, p = 0.32679 \)):
- Cada aumento de 1 unidade na generosidade est√° associado a um aumento m√©dio de **0.4898 unidades** em \( \text{Score} \), mantendo as outras vari√°veis constantes.

- N√£o significativo (\( p > 0.05 \)).Isso sugere que a generosidade n√£o tem uma contribui√ß√£o estatisticamente relevante para prever \( \text{Score} \) neste modelo.

### Perceptions of corruption(\( \beta = 0.9723, p = 0.07553 \)): 

- Cada aumento de 1 unidade na  percep√ß√£o de corrup√ß√£o est√° associado a um aumento m√©dio de **0.9723 unidades** em \( \text{Score} \), mantendo as outras vari√°veis constantes.

- N√£o significativo (\( p > 0.05 \)). Embora pr√≥ximo do limite de signific√¢ncia, o impacto da percep√ß√£o de corrup√ß√£o no \( \text{Score} \) n√£o √© relevante no modelo.

## Interpreta√ß√£o do coeficiente de determina√ß√£o (\( R^2 \))

```{r, message=FALSE, warning=FALSE}

resumo_modelo <- summary(modelo)

r2 <- resumo_modelo$r.squared
cat("O coeficiente de determina√ß√£o (R¬≤) √©:", round(r2, 4), "\n")

r2_ajustado <- resumo_modelo$adj.r.squared
cat("O coeficiente de determina√ß√£o ajustado (R¬≤ ajustado) √©:", round(r2_ajustado, 4), "\n")

```

### Coeficiente de Determina√ß√£o (\( R^2 = 0.7792 \))
- O \( R^2 \) indica que **77,92% da varia√ß√£o total na pontua√ß√£o de felicidade (\( \text{Score} \)) √© explicada pelas vari√°veis independentes** no modelo de regress√£o.
- Um \( R^2 \) pr√≥ximo de 1 significa que o modelo tem um bom ajuste, ou seja, ele explica uma grande parte da variabilidade da vari√°vel resposta.

### Coeficiente de Determina√ß√£o Ajustado (\( R^2 \text{ ajustado} = 0.7703 \))
- O \( R^2 \) ajustado leva em conta o n√∫mero de vari√°veis independentes no modelo e penaliza a inclus√£o de vari√°veis que n√£o contribuem significativamente para explicar a vari√°vel resposta.
- Aqui, o \( R^2 \) ajustado √© quase igual o \( R^2 \), indicando que o modelo √© eficiente e as vari√°veis escolhidas t√™m relev√¢ncia, mas algumas podem ter contribui√ß√£o menor. 

## ANOVA (COMPLEMENTAR COM VALOR F )
```{r}
anova(modelo)
```

### Signific√¢ncia dos estimadores com base na ANOVA 

Com um n√≠vel de signific√¢ncia de \( p = 0.05 \), podemos analisar as vari√°veis com base na tabela ANOVA:

#### Conclus√µes Baseadas no \( p \)-valor de 0.05

##### Vari√°veis Significativas (\( p < 0.05 \)):

- **GDP per capita (\( p = 2.2e^{-16} \)):**
  - √â altamente significativa. Indica que o PIB per capita tem uma forte influ√™ncia na pontua√ß√£o de felicidade (\( \text{Score} \)). Ele explica uma parte relevante da variabilidade do Score, indicando que regi√µes com PIB per capita maior tendem a ter pontua√ß√µes mais altas no Score.
  
- **Social support (\( p = 6.558e^{-11} \)):**
  - √â altamente significativa. Mostra que o suporte social √© uma das principais vari√°veis que explicam a felicidade. Isso sugere que lugares com maior suporte social (provavelmente medido em redes de apoio e conex√µes sociais) apresentam pontua√ß√µes mais altas no Score.
  
- **Healthy lifeexpectancy (\( p = 8.041e^{-07} \)):**
  - Tamb√©m √© altamente significativa, demonstrando que a expectativa de vida tem um impacto relevante na felicidade. Assim, quanto maior a expectativa de vida, maior o Score.


  - **Freedom to make life choices (\( p = 1.722e^{-07} \)):**
  - Significativa. Indica que a liberdade para tomar decis√µes na vida est√° fortemente associada √† pontua√ß√£o de felicidade. Dessa forma, lugares onde as pessoas percebem que t√™m maior liberdade para tomar decis√µes pessoais apresentam maior Score.

##### Vari√°veis N√£o Significativas (\( p \geq 0.05 \)):

- **Generosity (\( p = 0.121989 \)):**
  - N√£o significativa. Isso sugere que a generosidade n√£o tem uma contribui√ß√£o estatisticamente relevante para explicar a felicidade. 
  
- **Perceptions of corruption (\( p = 0.075526 \)):**
  - N√£o significativa (\( p > 0.05 \)), mas pr√≥xima ao limite. Embora a percep√ß√£o de corrup√ß√£o possa ter algum impacto, neste modelo, ela n√£o √© estatisticamente relevante para explicar a pontua√ß√£o de felicidade, n√£o tem um impacto claro no Score.
  

## Multicolinearidade

```{r, multicolinearidade}
# Matriz de vari√¢ncia e covari√¢ncia arredondada
vcov_matrix <- round(vcov(modelo), digits = 6)

# Exibir a matriz de vari√¢ncia e covari√¢ncia formatada
vcov_matrix %>%
  kable(format = "html", caption = "Matriz de Vari√¢ncia e Covari√¢ncia") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))

# An√°lise de multicolinearidade (VIF)
vif_values <- vif(modelo)

# Exibir os valores de VIF formatados
vif_values %>%
  kable(format = "html", caption = "Valores de VIF para Diagn√≥stico de Multicolinearidade") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "condensed"))


```

### Conclus√£o: 
Com os resultados apresentados, evidencia-se que n√£o h√° multicolinearidade entre as var√≠√°veis:
- Nenhuma das vari√°veis independentes apresentou \( \text{VIF} > 10 \), o que indica que a multicolinearidade no modelo √© **moderada** e aceit√°vel.


## An√°lise de res√≠duos:

```{r, residuos}
residuos = residuals(modelo)
```

### Independ√™ncia:
Nesse caso os dados s√£o espaciais, mas esse fator √© desconsiderado para as an√°lises.

### Normalidade:

#### Histograma:

```{r, hist}
# Histograma dos Res√≠duos
ggplot(modelo, aes(.resid)) +
  geom_histogram(bins = 30, fill = "#3eb2e4", color = "black") +
  labs(title = "Histograma dos Res√≠duos",
       x = "Res√≠duos",
       y = " ") +
  theme_minimal()
```

#### Qqplot:
```{r, qqplot}
ggplot(data.frame(residuos), mapping = aes(sample = residuos)) +
    stat_qq_band(distribution = "norm") +
    stat_qq_line(distribution = "norm") +
    stat_qq_point(distribution = "norm") +
    labs(x = "Quantis Te√≥ricos", y = "Quantis Amostrais")+
    theme_minimal()

```

#### Teste de Normalidade:
```{r, normalidade}
norm.test.stat = c(shapiro.test(modelo$residuals)$statistic, 
                   ks.test(modelo$residuals, "pnorm")$statistic)

norm.test.pvalue = c(shapiro.test(modelo$residuals)$p.value, 
                   ks.test(modelo$residuals, "pnorm")$p.value)

norm.test = cbind(norm.test.stat, norm.test.pvalue)

rownames(norm.test) = c("Shapiro-Wilk", "Kolmogorov-Smirnov")

colnames(norm.test) = c("Statistic", "P.value")

kable(norm.test, align = "c", caption = "Testes de normalidade")
```

#### Conclus√£o:
Atrav√©s do histograma podemos notar um comportamento n√£o normal dos res√≠duos.Pelo qqplot, √© poss√≠vel avaliar a n√£o normalidade dos dados, principalmente nas caudas.E os testes de Shapiro-Wilk e Kolmogorov-Smirnov rejeitaram a hip√≥tese nula de que os dados sejam normalmente distribu√≠dos.Logo, os res√≠duos desse modelo n√£o seguem distribui√ß√£o normal.

### Homocedasticidade:

#### Gr√°fico dos Res√≠duo $\times$ Valores ajustados
```{r, homo, fig.width=10, fig.height=4}
autoplot(modelo, which = 1, label.size = 3)
```

#### Teste Breusch-Pagan:
```{r, pagan}
homo.test = cbind(bptest(modelo, studentize = FALSE)$statistic, 
                  bptest(modelo, studentize = FALSE)$p.value)

rownames(homo.test) = c("Breusch-Pagan")
colnames(homo.test) = c("Statistic", "P.value")

kable(homo.test, align = "c", caption = "Teste de homocedasticidade")

```

#### Conclus√£o:
Pelo gr√°fico dos res√≠duo $\times$ valores ajustados, os res√≠duos parecem se comportar de forma aleat√≥ria. Por√©m, o teste de Breusch-Pagan rejeitou a hip√≥tese nula de homoscedasticidade. Logo os res√≠duos n√£o apresentam vari√¢ncia constante.


## Outliers, pontos de alavanca e pontos influentes

### Outliers

```{r, outliers}
# Res√≠duos padronizados
residuos_padronizados <- rstandard(modelo)

# Identificar observa√ß√µes 
outliers <- which(abs(residuos_padronizados) > 3)
outliers
```


```{r, outliers2, fig.width=10, fig.height=4}
autoplot(modelo, 3, label.size = 3)
```

Com base no c√≥digo acima, o qual calcula os res√≠duos padronizados, √© poss√≠vel perceber que h√° dois outliers, as observa√ß√µes 148 e 152. Essas observa√ß√µes desviam significativamente do padr√£o esperado do modelo, e nesse caso, s√£o os pa√≠ses Botswana e Rwanda, ambos pa√≠ses da √Åfrica. Al√©m disso, com base no gr√°fico, tamb√©m √© poss√≠vel observar que esses pa√≠ses est√£o mais afastados da reta de regress√£o esperada. 

### Alavancas

```{r, alavanca1}
# Calcular leverage
leverage <- hatvalues(modelo)

# Crit√©rio para leverage alto
n <- nrow(data)
k <- length(coef(modelo)) - 1
cutoff_leverage <- 2 * (k + 1) / n 
cutoff_leverage


# Identificar pontos de alavanca
pontos_alavanca <- which(leverage > cutoff_leverage)
pontos_alavanca
length(pontos_alavanca)

hat_valores <- hatvalues(modelo)
df <- data.frame(
  obs = seq_along(hat_valores),
  hat = hat_valores
)

limite <- 2 * mean(hat_valores)
limite


ggplot(df, aes(x = obs, y = hat)) +
  geom_bar(stat = "identity", fill = "darkcyan", alpha = 0.8) +
  geom_hline(yintercept = limite, color = "red", linetype = "dashed") +
  theme_minimal() +
  labs(title = "Valores de Alavancagem (Hat Values)",
       x = "√çndice da Observa√ß√£o",
       y = "Leverage")

ggplot(df, aes(x = obs, y = hat)) +
  geom_point(size = 3, color = "blue") +
  geom_hline(yintercept = limite, color = "purple", linetype = "dashed") +
  # Adicionando r√≥tulos condicionalmente
  geom_text(
    aes(label = ifelse(hat > limite, obs, "")),  # s√≥ mostra obs se hat>limite
    vjust = -0.5,   # ajusta a posi√ß√£o vertical do texto
    color = "purple"
  ) +
  theme_minimal() +
  labs(
    title = "Gr√°fico de Alavancagem (Hat Values) com r√≥tulos de outliers",
    x = "√çndice da Observa√ß√£o",
    y = "Leverage (Hat Values)"
  )

```

√â poss√≠vel perceber que h√° 9 observa√ß√µes que excedem o limite como indicador de alavancagem, as quais s√£o 34,  92, 112, 131, 135, 147, 149, 152 e 155. 

### Pontos influentes

```{r, influente, fig.width=10, fig.height=4}
cooks_distance <- cooks.distance(modelo)

length(data$Score)

# Identificar observa√ß√µes com dist√¢ncia de Cook > 1
which(cooks_distance > 1)
which(cooks_distance > 4/length(data$Score))

length(which(cooks_distance > 4/length(data$Score)))

autoplot(modelo, 4, label.size = 3)
```

Logo, com base nos c√°lculos e no gr√°fico, h√° 8 pontos influentes, os quais s√£o as observa√ß√µes 1, 34, 76, 102, 131, 148, 152, 155.

```{r, influente2}
pontos_influentes <- c(1, 34, 76, 102, 131, 148, 152, 155)
length(pontos_influentes)
dados_influentes <- data[pontos_influentes, c("Country.or.region")] 
dados_influentes$ponto <- pontos_influentes
dados_influentes
```

## Transforma√ß√£o (TERMINAR)
 - Com base na an√°lise de Box-Cox, o par√¢metro $\lambda$ que maximiza o log foi estimado como $\lambda \approx 1 $, com um intervalo de confian√ßa de 95% que tamb√©m inclui este valor. Isso significa que a transforma√ß√£o ideal para os dados seria praticamente equivalente a manter a vari√°vel dependente (ùëå) em sua escala original.
  Dessa forma, n√£o √© necess√°rio aplicar nenhuma transforma√ß√£o significativa aos dados, pois o m√©todo indica que o modelo ajustado com os valores originais j√° √© adequado. Assim, podemos prosseguir com a an√°lise sem realizar altera√ß√µes na escala da vari√°vel dependente.
```{r}
library(MASS)
boxcox(modelo, lambda = seq(-2, 2, by = 0.1))
```



## Conclus√£o 

- Com base nos resultados obtidos, conclui-se que o modelo de regress√£o linear apresentou um bom ajuste, explicando aproximadamente 77,92% da varia√ß√£o na pontua√ß√£o de felicidade (Score) dos pa√≠ses analisados. Entre as vari√°veis explicativas, PIB per capita, suporte social, expectativa de vida e liberdade para tomar decis√µes destacaram-se como fatores significativos e positivamente associados √† felicidade, refor√ßando a import√¢ncia de investimentos econ√¥micos e sociais para a melhoria do bem-estar das popula√ß√µes. Por outro lado, generosidade e percep√ß√£o de corrup√ß√£o n√£o apresentaram signific√¢ncia estat√≠stica no modelo, sugerindo que esses fatores, embora relevantes no contexto geral, n√£o desempenham papel determinante na explica√ß√£o do Score nesse conjunto de dados. Esses resultados oferecem inform√ß√µes valiosas para governos e formuladores de pol√≠ticas p√∫blicas sobre os principais determinantes da felicidade em diferentes pa√≠ses.





